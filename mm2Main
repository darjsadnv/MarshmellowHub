local plr = game:GetService("Players").LocalPlayer
local tween = game:GetService("TweenService")

-- Welcome Text UI
local textui = Instance.new("ScreenGui")
textui.Parent = plr:WaitForChild("PlayerGui")
local text = Instance.new("TextLabel")
text.Parent = textui
text.Text = "Welcome, follow zengy_v4 on tiktok"
text.Font = Enum.Font.DenkOne
text.TextSize = 30
text.BackgroundTransparency = 1
text.TextScaled = false
text.Position = UDim2.new(0, 0, 0, 0)
text.Size = UDim2.new(1, 0, 1, 0)
text.TextColor3 = Color3.new(1, 1, 1)
text.TextStrokeTransparency = 0
local goal = {TextTransparency = 1}
local tween1 = tween:Create(text, TweenInfo.new(5), goal)
tween1:Play()

-- After welcome text fades out
tween1.Completed:Connect(function()
	textui:Destroy()
	local ui = Instance.new("ScreenGui")
	ui.Parent = plr:WaitForChild("PlayerGui")

	-- ImageButton
	local ib = Instance.new("ImageButton")
	ib.Image = "rbxassetid://115146434078797"
	ib.Size = UDim2.new(0, 56, 0, 46)
	ib.Parent = ui
	ib.Position = UDim2.new(0.5, -28, 0.5, -23)

	-- Draggable ImageButton
	local dragging = false
	local dragInput, startPos
	ib.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			startPos = input.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	ib.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	game:GetService("UserInputService").InputChanged:Connect(function(input)
		if dragging and input == dragInput then
			local delta = input.Position - startPos
			ib.Position = UDim2.new(ib.Position.X.Scale, ib.Position.X.Offset + delta.X, ib.Position.Y.Scale, ib.Position.Y.Offset + delta.Y)
			startPos = input.Position
		end
	end)

	-- Hover effects
	ib.MouseEnter:Connect(function()
		ib:TweenSize(UDim2.new(0, 70, 0, 60), "Out", "Quad", 0.5)
	end)
	ib.MouseLeave:Connect(function()
		ib:TweenSize(UDim2.new(0, 56, 0, 46), "Out", "Quad", 0.5)
	end)

	-- Frame UI (Modern Design)
	local frame = Instance.new("Frame")
	frame.Parent = ui
	frame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
	frame.BackgroundTransparency = 1
	frame.Size = UDim2.new(0, 400, 0, 300)
	frame.Position = UDim2.new(0.294, 0, 0.325, 0) -- Initial position
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.Visible = false
	frame.ClipsDescendants = true
	-- Modified txv3 TextLabel
	local txv3 = Instance.new("TextLabel")
	txv3.Parent = frame
	txv3.Text = "Marshmallow Hub V3"
	txv3.Font = Enum.Font.GothamBold -- Modern font
	txv3.TextSize = 20 -- Slightly smaller than the title
	txv3.TextColor3 = Color3.new(1, 1, 1) -- White text
	txv3.BackgroundTransparency = 1 -- Transparent background
	txv3.Size = UDim2.new(1, 0, 0, 30) -- Smaller height
	txv3.Position = UDim2.new(0, 0, 0, 12) -- Moved slightly higher
	txv3.TextXAlignment = Enum.TextXAlignment.Center -- Center text horizontally
	txv3.TextYAlignment = Enum.TextYAlignment.Center -- Center text vertically
	txv3.TextStrokeTransparency = 0.5 -- Add a subtle text stroke for better readability
	txv3.TextStrokeColor3 = Color3.new(0, 0, 0) -- Black stroke

	-- Gradient for txv3
	local txv3Gradient = Instance.new("UIGradient")
	txv3Gradient.Parent = txv3
	txv3Gradient.Rotation = 90 -- Vertical gradient
	txv3Gradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.new(0.4, 0.2, 0.6)), -- Purple start
		ColorSequenceKeypoint.new(1, Color3.new(0.2, 0.1, 0.4)) -- Dark purple end
	})

	-- Optional Background for txv3
	local txv3Background = Instance.new("Frame")
	txv3Background.Parent = frame
	txv3Background.BackgroundColor3 = Color3.new(0.15, 0.15, 0.25)
	txv3Background.BackgroundTransparency = 0.7 -- More transparent
	txv3Background.Size = UDim2.new(1, 0, 0, 30)
	txv3Background.Position = UDim2.new(0, 0, 0, 30)
	txv3Background.ZIndex = -1 -- Ensure it's behind the text

	local txv3Corner = Instance.new("UICorner")
	txv3Corner.Parent = txv3Background
	txv3Corner.CornerRadius = UDim.new(0, 8) -- Rounded corners

	-- Ensure the text is on top of the background
	txv3.ZIndex = 2

	-- Modify Frame Appearance
	frame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1) -- Dark background
	frame.BackgroundTransparency = 0.3 -- Slightly transparent

	-- Add a Border to the Frame
	local frameBorder = Instance.new("UIStroke")
	frameBorder.Parent = frame
	frameBorder.Color = Color3.new(0.4, 0.2, 0.6) -- Purple border
	frameBorder.Thickness = 2 -- Border thickness
	frameBorder.Transparency = 0.5 -- Slightly transparent

	-- Improve Frame Gradient
	local frameGradient = Instance.new("UIGradient")
	frameGradient.Parent = frame
	frameGradient.Rotation = 90 -- Vertical gradient
	frameGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.new(0.2, 0.2, 0.4)), -- Start color
		ColorSequenceKeypoint.new(1, Color3.new(0.1, 0.1, 0.2)) -- End color
	})

	-- Rounded Corners for Frame
	local frameCorner = Instance.new("UICorner")
	frameCorner.Parent = frame
	frameCorner.CornerRadius = UDim.new(0, 12) -- Rounded corners

	-- Title Bar Gradient
	local titleBarGradient = Instance.new("UIGradient")
	titleBarGradient.Parent = titleBar
	titleBarGradient.Rotation = 90 -- Vertical gradient
	titleBarGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.new(0.3, 0.2, 0.5)), -- Start color
		ColorSequenceKeypoint.new(1, Color3.new(0.2, 0.1, 0.3)) -- End color
	})

	-- Close Button Gradient
	local closeButtonGradient = Instance.new("UIGradient")
	closeButtonGradient.Parent = closeButton
	closeButtonGradient.Rotation = 90 -- Vertical gradient
	closeButtonGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.new(0.8, 0.2, 0.2)), -- Red start
		ColorSequenceKeypoint.new(1, Color3.new(0.5, 0.1, 0.1)) -- Dark red end
	})

	-- Rounded Corners for Close Button
	local closeButtonCorner = Instance.new("UICorner")
	closeButtonCorner.Parent = closeButton
	closeButtonCorner.CornerRadius = UDim.new(0, 8) -- Rounded corners


	-- Gradient Background
	local gradient = Instance.new("UIGradient")
	gradient.Parent = frame
	gradient.Rotation = 90
	gradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.new(0.2, 0.2, 0.4)),
		ColorSequenceKeypoint.new(1, Color3.new(0.1, 0.1, 0.2))
	})

	-- Rounded Corners
	local corner = Instance.new("UICorner")
	corner.Parent = frame
	corner.CornerRadius = UDim.new(0, 12)

	-- Title Bar
	local titleBar = Instance.new("Frame")
	titleBar.Parent = frame
	titleBar.BackgroundColor3 = Color3.new(0.15, 0.15, 0.25)
	titleBar.Size = UDim2.new(1, 0, 0, 40)
	titleBar.Position = UDim2.new(0, 0, 0, 0)

	-- Title Text
	local title = Instance.new("TextLabel")
	title.Parent = titleBar
	title.Text = "Marshmallow Hub V3"
	title.Font = Enum.Font.GothamBold
	title.TextSize = 18
	title.TextColor3 = Color3.new(1, 1, 1)
	title.BackgroundTransparency = 1
	title.Position = UDim2.new(0.5, 0, 0.5, 0)
	title.AnchorPoint = Vector2.new(0.5, 0.5)
	title.TextScaled = true

	-- Close Button (Fixed Placement)
	local closeButton = Instance.new("TextButton")
	closeButton.Parent = titleBar
	closeButton.Text = "X"
	closeButton.Font = Enum.Font.GothamBold
	closeButton.TextSize = 16
	closeButton.TextColor3 = Color3.new(1, 1, 1)
	closeButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
	closeButton.Position = UDim2.new(1, -10, 0.5, 0)
	closeButton.Size = UDim2.new(0, 30, 0, 30)
	closeButton.AnchorPoint = Vector2.new(1, 0.5)

	-- Add Close Button Functionality
	closeButton.MouseButton1Click:Connect(function()
		local frameTweenOut = tween:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			BackgroundTransparency = 1,
			Size = UDim2.new(0, 0, 0, 0)
		})
		frameTweenOut:Play()
		frameTweenOut.Completed:Wait()
		frame.Visible = false
	end)

	-- Draggable Frame
	local frameDragging = false
	local frameDragInput, frameStartPos
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			frameDragging = true
			frameStartPos = input.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					frameDragging = false
				end
			end)
		end
	end)
	titleBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			frameDragInput = input
		end
	end)
	game:GetService("UserInputService").InputChanged:Connect(function(input)
		if frameDragging and input == frameDragInput then
			local delta = input.Position - frameStartPos
			frame.Position = UDim2.new(frame.Position.X.Scale, frame.Position.X.Offset + delta.X, frame.Position.Y.Scale, frame.Position.Y.Offset + delta.Y)
			frameStartPos = input.Position
		end
	end)

	-- Content Frame
	local content = Instance.new("Frame")
	content.Parent = frame
	content.BackgroundTransparency = 1
	content.Size = UDim2.new(1, -20, 1, -60)
	content.Position = UDim2.new(0, 10, 0, 50)
	-- ESP Toggle Button
	local espButton = Instance.new("TextButton")
	espButton.Parent = content
	espButton.Text = "ESP: Off"
	espButton.Font = Enum.Font.GothamBold
	espButton.TextSize = 18
	espButton.TextColor3 = Color3.new(1, 1, 1)
	espButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
	espButton.Size = UDim2.new(0, 200, 0, 50)
	espButton.Position = UDim2.new(0.5, -100, 0.7, -25)
	espButton.AnchorPoint = Vector2.new(0.5, 0.5)
	espButton.AutoButtonColor = false

	-- ESP Toggle Functionality
	local espEnabled = false
	local espBoxes = {} -- Stores ESP boxes for each player

	espButton.MouseButton1Click:Connect(function()
		espEnabled = not espEnabled
		if espEnabled then
			espButton.Text = "ESP: On"
			espButton.BackgroundColor3 = Color3.new(0, 0.5, 0)
			EnableESP()
		else
			espButton.Text = "ESP: Off"
			espButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
			DisableESP()
		end
	end)

	-- Function to Enable ESP
	function EnableESP()
		for _, player in pairs(Players:GetPlayers()) do
			if player ~= plr and player.Character then
				local box = Instance.new("BoxHandleAdornment")
				box.Size = player.Character:FindFirstChild("HumanoidRootPart").Size + Vector3.new(0.1, 0.1, 0.1)
				box.Adornee = player.Character:FindFirstChild("HumanoidRootPart")
				box.AlwaysOnTop = true
				box.ZIndex = 10
				box.Transparency = 0.5
				box.Color3 = Color3.new(1, 0, 0)
				box.Parent = player.Character:FindFirstChild("HumanoidRootPart")
				espBoxes[player] = box
			end
		end
	end

	-- Function to Disable ESP
	function DisableESP()
		for player, box in pairs(espBoxes) do
			box:Destroy()
		end
		espBoxes = {}
	end

	-- Marshmallow Hub V3 MM2 Script Text Label
	local mm2Text = Instance.new("TextLabel")
	mm2Text.Parent = content
	mm2Text.Text = "Marshmallow Hub V3 MM2 Script"
	mm2Text.Font = Enum.Font.GothamBold
	mm2Text.TextSize = 20
	mm2Text.TextColor3 = Color3.new(1, 1, 1)
	mm2Text.BackgroundTransparency = 1
	mm2Text.Position = UDim2.new(0.5, 0, 0.1, 0)
	mm2Text.AnchorPoint = Vector2.new(0.5, 0)
	mm2Text.TextScaled = true

	-- Aimbot Toggle Button
	local aimbotButton = Instance.new("TextButton")
	aimbotButton.Parent = content
	aimbotButton.Text = "Aimbot: Off"
	aimbotButton.Font = Enum.Font.GothamBold
	aimbotButton.TextSize = 18
	aimbotButton.TextColor3 = Color3.new(1, 1, 1)
	aimbotButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
	aimbotButton.Size = UDim2.new(0, 200, 0, 50)
	aimbotButton.Position = UDim2.new(0.5, -100, 0.5, -25)
	aimbotButton.AnchorPoint = Vector2.new(0.5, 0.5)
	aimbotButton.AutoButtonColor = false

	-- Aimbot Toggle Functionality
	local aimbotEnabled = false
	aimbotButton.MouseButton1Click:Connect(function()
		aimbotEnabled = not aimbotEnabled
		if aimbotEnabled then
			aimbotButton.Text = "Aimbot: On"
			aimbotButton.BackgroundColor3 = Color3.new(0, 0.5, 0)
			_G.AimbotEnabled = true
		else
			aimbotButton.Text = "Aimbot: Off"
			aimbotButton.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
			_G.AimbotEnabled = false
		end
	end)

	-- Tween for frame pop-up
	local frameTweenIn = tween:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		BackgroundTransparency = 0,
		Size = UDim2.new(0, 400, 0, 300)
	})
	local frameTweenOut = tween:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 0, 0, 0)
	})

	-- Show frame when ImageButton is clicked
	ib.MouseButton1Click:Connect(function()
		frame.Visible = true
		frameTweenIn:Play()
	end)
end)

-- Aimbot Code
local Camera = workspace.CurrentCamera
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Holding = false

_G.AimbotEnabled = false
_G.TeamCheck = false
_G.AimPart = "Head"
_G.Sensitivity = 0
_G.FOV = 50

local function GetClosestPlayer()
	local MaximumDistance = math.huge
	local Target = nil

	for _, v in next, Players:GetPlayers() do
		if v.Name ~= LocalPlayer.Name then
			if _G.TeamCheck == true then
				if v.Team ~= LocalPlayer.Team then
					if v.Character ~= nil then
						if v.Character:FindFirstChild("HumanoidRootPart") ~= nil then
							if v.Character:FindFirstChild("Humanoid") ~= nil and v.Character:FindFirstChild("Humanoid").Health ~= 0 then
								local ScreenPoint = Camera:WorldToScreenPoint(v.Character:WaitForChild("HumanoidRootPart", math.huge).Position)
								local VectorDistance = (Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y) - Vector2.new(ScreenPoint.X, ScreenPoint.Y)).Magnitude

								-- Check if the player is within the FOV
								local direction = (v.Character.HumanoidRootPart.Position - Camera.CFrame.Position).unit
								local angle = math.deg(math.acos(direction:Dot(Camera.CFrame.LookVector)))
								if angle < _G.FOV then
									if VectorDistance < MaximumDistance then
										Target = v
										MaximumDistance = VectorDistance
									end
								end
							end
						end
					end
				end
			else
				if v.Character ~= nil then
					if v.Character:FindFirstChild("HumanoidRootPart") ~= nil then
						if v.Character:FindFirstChild("Humanoid") ~= nil and v.Character:FindFirstChild("Humanoid").Health ~= 0 then
							local ScreenPoint = Camera:WorldToScreenPoint(v.Character:WaitForChild("HumanoidRootPart", math.huge).Position)
							local VectorDistance = (Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y) - Vector2.new(ScreenPoint.X, ScreenPoint.Y)).Magnitude

							-- Check if the player is within the FOV
							local direction = (v.Character.HumanoidRootPart.Position - Camera.CFrame.Position).unit
							local angle = math.deg(math.acos(direction:Dot(Camera.CFrame.LookVector)))
							if angle < _G.FOV then
								if VectorDistance < MaximumDistance then
									Target = v
									MaximumDistance = VectorDistance
								end
							end
						end
					end
				end
			end
		end
	end
	return Target
end

UserInputService.InputBegan:Connect(function(Input)
	if Input.UserInputType == Enum.UserInputType.MouseButton2 then
		Holding = true
	end
end)

UserInputService.InputEnded:Connect(function(Input)
	if Input.UserInputType == Enum.UserInputType.MouseButton2 then
		Holding = false
	end
end)

RunService.RenderStepped:Connect(function()
	if Holding == true and _G.AimbotEnabled == true then
		local target = GetClosestPlayer()
		if target then
			TweenService:Create(Camera, TweenInfo.new(_G.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {CFrame = CFrame.new(Camera.CFrame.Position, target.Character[_G.AimPart].Position)}):Play()
		end
	end
end) 
